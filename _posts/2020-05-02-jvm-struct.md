---
layout: post
title:  "JVM之运行时数据区"
date:   2020-05-02 10:28:50 +0800
categories: jvm
author: heoller
introduction: 运行时数据区
---
## 栈
当jvm开始运行一个线程时，就会为这个线程在开辟一个栈空间。

可以通过`-Xss`参数设置每个线程的栈空间大小, 默认1M。如果设置值越小，
对于JVM而言，能开启的线程就会越多。

* 栈帧
当线程执行方法时，会为该方法在线程所属的栈空间上开辟一个栈帧空间。
    - 栈帧结构
        - 局部变量表
        - 操作数栈
        - 动态链接
        - 方法出口

* 栈和堆
栈帧中的变量可能存储了堆中对象的引用

* 栈和程序计数器
每个栈(线程)都对应一个程序计数器

## 方法区(元空间)
不会占用jvm启动时分配的内存空间，而是使用直接内存。方法区存储了常量、静态变量以及类元信息。

* 方法区和堆
方法区中的静态变量可能存储了堆中对象的引用

## 堆
当反生GC时，会产生STW(Stop The World)现象。

* 结构

    年轻代(Eden + Survivor(From + To)) + 老年代

    * 默认比例：
        * 年轻代:老年代 = 1:2
        * Eden:Survivor = 8:1
        * From:To = 1:1

## 进入老年代的情况

* 长期存活的对象，可通过`-XX:MaxTenuringThreshold`设置对象的分代年龄。
* 大对象, 可通过JVM参数`-XX:PretenureSizeThreshold`设置大对象的大小。但是该参数只在`Serial`和`ParNew`两个收集器下有效。
* 动态年龄判断
* 老年代空间分配担保机制
* 年轻代GC后，Survivor区放不下




